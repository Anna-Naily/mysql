Практическое задание по теме “Транзакции, переменные, представления”
Задание 1.
use shop;
START TRANSACTION;
INSERT INTO sample.users
SELECT * FROM shop.users WHERE id = 1;
DELETE FROM shop.users WHERE id = 1;
COMMIT;
USE sample;
SELECT * FROM users;

Задлание 2. 
use shop;
DROP VIEW IF EXISTS cat;
CREATE VIEW cat AS SELECT products.name, catalogs.name AS catalog_name 
FROM (products LEFT JOIN catalogs ON products.catalog_id = catalogs.id);
SELECT * FROM cat;

Практическое задание по теме “Хранимые процедуры и функции, триггеры"

Задание 1.
use shop;
DROP FUNCTION IF EXISTS hello;
DELIMITER //
CREATE FUNCTION hello ()
RETURNS TEXT NOT DETERMINISTIC
BEGIN
DECLARE hello_text TEXT;
 IF ((SELECT CURRENT_TIME()) >= CAST('06:00:00' AS time) AND CURRENT_TIME() < CAST('12:00:00' AS time))
  THEN SET hello_text = 'Доброе утро';
 ELSEIF ((SELECT CURRENT_TIME()) >= CAST('12:00:00' AS time) AND CURRENT_TIME() < CAST('18:00:00' AS time))
  THEN SET hello_text = 'Добрый день';
 ELSEIF ((SELECT CURRENT_TIME()) >= CAST('18:00:00' AS time) AND CURRENT_TIME() <= CAST('23:59:59' AS time))
  THEN SET hello_text = 'Добрый вечер';
 ELSEIF ((SELECT CURRENT_TIME()) >= CAST('00:00:00' AS time) AND CURRENT_TIME() < CAST('06:00:00' AS time))
  THEN SET hello_text = 'Доброй ночи';
 END IF;
 RETURN hello_text;
END; 
DELIMITER ;

SELECT hello();

Задание 2.
use shop;
DROP TRIGGER IF EXISTS check_null;
DELIMITER //
CREATE TRIGGER check_null BEFORE INSERT ON products
FOR EACH ROW
BEGIN
 IF(ISNULL(NEW.name) AND ISNULL(NEW.description)) 
 THEN SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = 'DELETE canceled';
	END IF;
END //
DELIMITER ;

-- проверка

INSERT INTO products (name, description, price, catalog_id)
VALUES ("проверка заполненое поле", NULL, 21333, 224);

INSERT INTO products (name, description, price, catalog_id)
VALUES (NULL, "проверка заполненое поле", 15000, 552);

INSERT INTO products (name, description, price, catalog_id)
VALUES (NULL, NULL, 1, 6); 

INSERT INTO products (name, description, price, catalog_id)
VALUES ("проверка заполненое поле", "проверка заполненое поле", 65646, 2234);

SELECT * FROM products;
